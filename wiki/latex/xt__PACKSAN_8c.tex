\hypertarget{xt__PACKSAN_8c}{
\section{trunk/Target/xt\_\-PACKSAN.c File Reference}
\label{xt__PACKSAN_8c}\index{trunk/Target/xt\_\-PACKSAN.c@{trunk/Target/xt\_\-PACKSAN.c}}
}


the target module  


{\ttfamily \#include \char`\"{}../Matcher/xt\_\-packsan.h\char`\"{}}\par
{\ttfamily \#include $<$linux/netfilter/x\_\-tables.h$>$}\par
{\ttfamily \#include $<$net/checksum.h$>$}\par
{\ttfamily \#include $<$net/tcp.h$>$}\par
{\ttfamily \#include $<$asm/checksum.h$>$}\par
\subsection*{Defines}
\begin{DoxyCompactItemize}
\item 
\hypertarget{xt__PACKSAN_8c_ac246607383ce61a69f303ba2e29e6cc3}{
\#define {\bfseries X\_\-TABLES\_\-H\_\-}}
\label{xt__PACKSAN_8c_ac246607383ce61a69f303ba2e29e6cc3}

\item 
\#define \hyperlink{xt__PACKSAN_8c_aa8c5d183e40aee94cc32b1eb54e9c8cc}{DOFF\_\-DISTANCE}~12
\item 
\#define \hyperlink{xt__PACKSAN_8c_a4e1d4437ed494b8b2d172764b9a18f5c}{UDP\_\-HDR\_\-LEN}~8
\item 
\#define \hyperlink{xt__PACKSAN_8c_a159ca84d25a5487d8e81e4438725df19}{LOG}~1
\begin{DoxyCompactList}\small\item\em Set it to 1 to log the activity. \item\end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{group__Extern__Declarations_ga781096a07e039b7a9cbe48abc453759f}{dealloc\_\-all\_\-list} (\hyperlink{structps__match__occurrence}{ps\_\-match} $\ast$head)
\begin{DoxyCompactList}\small\item\em deallocates the whole list of matches \item\end{DoxyCompactList}\item 
\hyperlink{structps__match__occurrence}{ps\_\-match} $\ast$ \hyperlink{group__Extern__Declarations_gaf81c8d97479ed96113a9b00bba4232a5}{KMP\_\-Matcher} (char $\ast$T, int T\_\-length, const char $\ast$P, int P\_\-length, unsigned int string\_\-index, int $\ast$matches)
\begin{DoxyCompactList}\small\item\em KMP matcher. \item\end{DoxyCompactList}\item 
void \hyperlink{xt__PACKSAN_8c_a4b5a9012d7b6c8789d980d8280ae0fe6}{varlen\_\-replace} (char $\ast$original, unsigned int original\_\-len, char $\ast$new, \hyperlink{structps__match__occurrence}{ps\_\-match} $\ast$matches)
\begin{DoxyCompactList}\small\item\em replaces the strings into the packet payload with regards to the found matches. \item\end{DoxyCompactList}\item 
\hyperlink{xt__PACKSAN_8c_a53f69348d446816d9d9810ae6d033df5}{module\_\-init} (packsan\_\-tg\_\-init)
\item 
\hyperlink{xt__PACKSAN_8c_a54285281821773141ed1404e0db98784}{module\_\-exit} (packsan\_\-tg\_\-exit)
\item 
\hyperlink{group__tg__info_ga184bfbc3a7ee1f2642b68330b6ffe735}{MODULE\_\-AUTHOR} (\char`\"{}PACKSAN TEAM:$<$packsanteam@gmail.com$>$\char`\"{})
\item 
\hyperlink{group__tg__info_ga5fde41c9d3972b96f26d4873ba800887}{MODULE\_\-DESCRIPTION} (\char`\"{}Xtables: Packet Sanitizer, clean your packets from bad strings!!!\char`\"{})
\item 
\hyperlink{group__tg__info_gad94b36675e7eb067ea3ce6ff9e244a44}{MODULE\_\-LICENSE} (\char`\"{}GPL\char`\"{})
\item 
\hyperlink{group__tg__info_ga9a25cec7f2114963efbbea43c4d28ff6}{MODULE\_\-ALIAS} (\char`\"{}ipt\_\-PACKSAN\char`\"{})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const unsigned int \hyperlink{group__Extern__Declarations_ga2cf154e4b14801b467e37c8f1dcd0aad}{strings\_\-number}
\item 
const char $\ast$ \hyperlink{group__Extern__Declarations_ga899c0fa2b3c57dba6154c77de83c8d39}{strings} \mbox{[}$\,$\mbox{]}
\item 
const char $\ast$ \hyperlink{group__Extern__Declarations_ga449ebc7257a18cdb95c138b530539f88}{var\_\-len\_\-replacements} \mbox{[}$\,$\mbox{]}
\item 
const char $\ast$ \hyperlink{group__Extern__Declarations_ga91ad013799247b2cd1330f1771d83cd9}{const\_\-len\_\-replacements} \mbox{[}$\,$\mbox{]}
\begin{DoxyCompactList}\small\item\em contains the string to replace into TCP packets \item\end{DoxyCompactList}\item 
const char $\ast$ \hyperlink{xt__PACKSAN_8c_aff373dc4973bdad250fabc1fd2b15d4d}{replacements}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
the target module This file contains the target module that finds the substrings inside the l4 payload and substitutes them. 

\subsection{Define Documentation}
\hypertarget{xt__PACKSAN_8c_aa8c5d183e40aee94cc32b1eb54e9c8cc}{
\index{xt\_\-PACKSAN.c@{xt\_\-PACKSAN.c}!DOFF\_\-DISTANCE@{DOFF\_\-DISTANCE}}
\index{DOFF\_\-DISTANCE@{DOFF\_\-DISTANCE}!xt_PACKSAN.c@{xt\_\-PACKSAN.c}}
\subsubsection[{DOFF\_\-DISTANCE}]{\setlength{\rightskip}{0pt plus 5cm}\#define DOFF\_\-DISTANCE~12}}
\label{xt__PACKSAN_8c_aa8c5d183e40aee94cc32b1eb54e9c8cc}
Distance of data offset field in tcp header \hypertarget{xt__PACKSAN_8c_a159ca84d25a5487d8e81e4438725df19}{
\index{xt\_\-PACKSAN.c@{xt\_\-PACKSAN.c}!LOG@{LOG}}
\index{LOG@{LOG}!xt_PACKSAN.c@{xt\_\-PACKSAN.c}}
\subsubsection[{LOG}]{\setlength{\rightskip}{0pt plus 5cm}\#define LOG~1}}
\label{xt__PACKSAN_8c_a159ca84d25a5487d8e81e4438725df19}


Set it to 1 to log the activity. 

Do you want to have a VERBOSE log of the module activity? set it to non-\/zero. \hypertarget{xt__PACKSAN_8c_a4e1d4437ed494b8b2d172764b9a18f5c}{
\index{xt\_\-PACKSAN.c@{xt\_\-PACKSAN.c}!UDP\_\-HDR\_\-LEN@{UDP\_\-HDR\_\-LEN}}
\index{UDP\_\-HDR\_\-LEN@{UDP\_\-HDR\_\-LEN}!xt_PACKSAN.c@{xt\_\-PACKSAN.c}}
\subsubsection[{UDP\_\-HDR\_\-LEN}]{\setlength{\rightskip}{0pt plus 5cm}\#define UDP\_\-HDR\_\-LEN~8}}
\label{xt__PACKSAN_8c_a4e1d4437ed494b8b2d172764b9a18f5c}
UDP header length: it's constant. 

\subsection{Function Documentation}
\hypertarget{xt__PACKSAN_8c_a54285281821773141ed1404e0db98784}{
\index{xt\_\-PACKSAN.c@{xt\_\-PACKSAN.c}!module\_\-exit@{module\_\-exit}}
\index{module\_\-exit@{module\_\-exit}!xt_PACKSAN.c@{xt\_\-PACKSAN.c}}
\subsubsection[{module\_\-exit}]{\setlength{\rightskip}{0pt plus 5cm}module\_\-exit (
\begin{DoxyParamCaption}
\item[{packsan\_\-tg\_\-exit}]{}
\end{DoxyParamCaption}
)}}
\label{xt__PACKSAN_8c_a54285281821773141ed1404e0db98784}
Linux macro to indicate which function to call at extraction. \hypertarget{xt__PACKSAN_8c_a53f69348d446816d9d9810ae6d033df5}{
\index{xt\_\-PACKSAN.c@{xt\_\-PACKSAN.c}!module\_\-init@{module\_\-init}}
\index{module\_\-init@{module\_\-init}!xt_PACKSAN.c@{xt\_\-PACKSAN.c}}
\subsubsection[{module\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}module\_\-init (
\begin{DoxyParamCaption}
\item[{packsan\_\-tg\_\-init}]{}
\end{DoxyParamCaption}
)}}
\label{xt__PACKSAN_8c_a53f69348d446816d9d9810ae6d033df5}
Linux macro to indicate which function to call at insertion. \hypertarget{xt__PACKSAN_8c_a4b5a9012d7b6c8789d980d8280ae0fe6}{
\index{xt\_\-PACKSAN.c@{xt\_\-PACKSAN.c}!varlen\_\-replace@{varlen\_\-replace}}
\index{varlen\_\-replace@{varlen\_\-replace}!xt_PACKSAN.c@{xt\_\-PACKSAN.c}}
\subsubsection[{varlen\_\-replace}]{\setlength{\rightskip}{0pt plus 5cm}varlen\_\-replace (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{original, }
\item[{unsigned int}]{original\_\-len, }
\item[{char $\ast$}]{new, }
\item[{{\bf ps\_\-match} $\ast$}]{matches}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}inline\mbox{]}}}}
\label{xt__PACKSAN_8c_a4b5a9012d7b6c8789d980d8280ae0fe6}


replaces the strings into the packet payload with regards to the found matches. 


\begin{DoxyParams}{Parameters}
{\em original} & the original text \\
\hline
{\em original\_\-len} & the length of the original text \\
\hline
{\em new} & the new area to write to \\
\hline
{\em matches} & the matches list \\
\hline
\end{DoxyParams}


\subsection{Variable Documentation}
\hypertarget{xt__PACKSAN_8c_aff373dc4973bdad250fabc1fd2b15d4d}{
\index{xt\_\-PACKSAN.c@{xt\_\-PACKSAN.c}!replacements@{replacements}}
\index{replacements@{replacements}!xt_PACKSAN.c@{xt\_\-PACKSAN.c}}
\subsubsection[{replacements}]{\setlength{\rightskip}{0pt plus 5cm}const char$\ast$ {\bf replacements}}}
\label{xt__PACKSAN_8c_aff373dc4973bdad250fabc1fd2b15d4d}
Global variable to store the address of the strings to replace 